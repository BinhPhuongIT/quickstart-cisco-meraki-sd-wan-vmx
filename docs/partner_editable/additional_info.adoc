// Add steps as necessary for accessing the software, post-configuration, and testing. Donâ€™t include full usage instructions for your software, but add links to your product documentation for that information.
//Should any sections not be applicable, remove them

== Post Deployment Steps
Post-Deployment, the addition of the workload VPCs as VPC attachments to the TransitGatewy and updating of the SD-WAN VPC route table for the workload subnets is required. 
Please, see below for the generic steps for a deployment using a single Transit Gateway and multiple workload VPCs within the same AWS account.

. Add the workload VPCs as VPC attachments to the TGW and associate with the TGW route table. Information and about creating Transit Gateway VPC attachments can be found https://docs.aws.amazon.com/vpc/latest/tgw/tgw-vpc-attachments.html[here^]
. Update VPC Route Tables. Information about VPC Route Tables can be found https://docs.aws.amazon.com/vpc/latest/userguide/WorkWithRouteTables.html#AddRemoveRoutes[here^]

The above steps might not suffice or there might be additional steps that can be required based on your deployment and setup workflow.

== vMX HA Architecture
//Provide any other information of interest to users, especially focusing on areas where AWS or cloud usage differs from on-premises usage.
The architecture is made fault tolerant by having two instances in different AZs. The lambda functions handles both an instance level failure by checking the EC2 instance state of the vMX and also software level failures by checking the 
vMX health state from the Meraki Dashboard. Incase of a vMX instance failure the lambda will detect the failure, log it to cloudwatch and also update the VPC and Transit Gateway routes to point to the healthy instance. 
For recovering a failed vMX instance, the following steps can be followed. 

. Login to the Meraki dashboard and generate a new Authentication token for the vMX instance. The steps to generate an Authentication token can be found under the link:#_deploy_steps[deployment steps] section
. Deploy a new vMX stack
.. Under Specify Stack details, specify the following parameters
... InstanceType: Choose the same Amazon EC2 instance type that was used before
... KeyPairName: An existing EC2 KeyPair
... SubnetID: Select the SubnetID the vMX will be deployed in
... vMXNetworkTag: Specify the Network Tag associated with the instance on the Meraki dashboard
... vMXToken: Enter the new Authentication token generated from the Meraki dashboard
+
image::../images/vmx-stack.png[vMX Stack]
+
.. Review the stack information and choose Create stack
+
More information about Cloudformation Stack Updates, cane be found https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-direct.html[here^]

== Best practices for using {partner-product-short-name} on AWS
// Provide post-deployment best practices for using the technology on AWS, including considerations such as migrating data, backups, ensuring high performance, high availability, etc. Link to software documentation for detailed information.
For vMX deployment best practices please refer to the https://documentation.meraki.com/MX/MX_Installation_Guides/vMX_Setup_Guide_for_Amazon_Web_Services_(AWS)#Meraki%20Dashboard%20Configuration[vMX Setup Guide for AWS^]

